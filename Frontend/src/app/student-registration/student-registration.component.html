<mat-card class="registration-card">
  <mat-card-header>
    <mat-card-title>STUDENT REGISTRATION FORM</mat-card-title>
  </mat-card-header>
  <mat-card-content>

    <div *ngIf="isLoading" class="spinner-overlay">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <form [formGroup]="registrationForm" class="full-form">
      <!-- Basic Information Section -->
      <div class="form-section">
        <h3 class="section-header">Basic Information</h3>
        
        <div class="form-row" formGroupName="basicDetails">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="first_name" required>
            <mat-error *ngIf="basicDetailsForm.get('first_name')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('first_name')) }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Middle Name</mat-label>
            <input matInput formControlName="middle_name">
            <mat-error *ngIf="basicDetailsForm.get('middle_name')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('middle_name')) }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="last_name">
            <mat-error *ngIf="basicDetailsForm.get('last_name')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('last_name')) }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row" formGroupName="basicDetails">
          <mat-form-field appearance="outline">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="dobPicker" formControlName="date_of_birth" required readonly>
            <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
            <mat-datepicker #dobPicker></mat-datepicker>
            <mat-error *ngIf="basicDetailsForm.get('date_of_birth')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('date_of_birth')) }}
            </mat-error>
          </mat-form-field>

          <div class="form-field-container">
            <label class="form-field-label">Gender</label>
            <mat-radio-group formControlName="gender" required color="primary">
              <mat-radio-button value="Male">Male</mat-radio-button>
              <mat-radio-button value="Female">Female</mat-radio-button>
              <mat-radio-button value="Other">Other</mat-radio-button>
            </mat-radio-group>
            <mat-error *ngIf="basicDetailsForm.get('gender')?.touched && basicDetailsForm.get('gender')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('gender')) }}
            </mat-error>
          </div>
        </div>

        <div class="form-row" formGroupName="basicDetails">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" required>
            <mat-error *ngIf="basicDetailsForm.get('email')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('email')) }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input matInput type="tel" formControlName="phone_number" required placeholder="e.g. 9876543210">
            <mat-error *ngIf="basicDetailsForm.get('phone_number')?.invalid">
              {{ getErrorMessage(basicDetailsForm.get('phone_number')) }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Address Information Section -->
      <div class="form-section">
        <h3 class="section-header">Address Information</h3>
        
        <div formGroupName="addressDetails">
          <h4 class="subsection-title">Current Address</h4>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Address Line</mat-label>
              <input matInput formControlName="current_addressLine" required>
              <mat-error *ngIf="addressDetailsForm.get('current_addressLine')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('current_addressLine')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Block/Area</mat-label>
              <input matInput formControlName="current_block" required>
              <mat-error *ngIf="addressDetailsForm.get('current_block')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('current_block')) }}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>District</mat-label>
              <input matInput formControlName="current_dist" required>
              <mat-error *ngIf="addressDetailsForm.get('current_dist')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('current_dist')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>State</mat-label>
              <input matInput formControlName="current_state" required>
              <mat-error *ngIf="addressDetailsForm.get('current_state')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('current_state')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Pincode</mat-label>
              <input matInput type="number" formControlName="current_pincode" required>
              <mat-error *ngIf="addressDetailsForm.get('current_pincode')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('current_pincode')) }}
              </mat-error>
            </mat-form-field>
          </div>

          <h4 class="subsection-title">Permanent Address</h4>
          <mat-checkbox formControlName="sameAsCurrent" color="primary">Same as Current Address</mat-checkbox>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Address Line</mat-label>
              <input matInput formControlName="permanent_addressLine" required>
              <mat-error *ngIf="addressDetailsForm.get('permanent_addressLine')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('permanent_addressLine')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Block/Area</mat-label>
              <input matInput formControlName="permanent_block" required>
              <mat-error *ngIf="addressDetailsForm.get('permanent_block')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('permanent_block')) }}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>District</mat-label>
              <input matInput formControlName="permanent_dist" required>
              <mat-error *ngIf="addressDetailsForm.get('permanent_dist')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('permanent_dist')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>State</mat-label>
              <input matInput formControlName="permanent_state" required>
              <mat-error *ngIf="addressDetailsForm.get('permanent_state')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('permanent_state')) }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Pincode</mat-label>
              <input matInput type="number" formControlName="permanent_pincode" required>
              <mat-error *ngIf="addressDetailsForm.get('permanent_pincode')?.invalid">
                {{ getErrorMessage(addressDetailsForm.get('permanent_pincode')) }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Document Upload Section -->
      <div class="form-section">
        <h3 class="section-header">Document Upload</h3>
        
        <div formGroupName="fileDetails" class="file-upload-section">
          <div class="file-input-container">
            <label>Profile Photo *</label>
            <button type="button" mat-stroked-button color="accent" (click)="photoInput.click()">
              <mat-icon>cloud_upload</mat-icon> Choose Photo
            </button>
            <input hidden type="file" #photoInput accept="image/*" (change)="onFileSelected($event, 'photo')">
            <span class="file-name">{{ getFileName(selectedPhoto) }}</span>
            <mat-error *ngIf="fileDetailsForm.get('photo')?.touched && fileDetailsForm.get('photo')?.hasError('required')">
              Photo is required
            </mat-error>
            <img *ngIf="photoPreview" [src]="photoPreview" class="file-preview" alt="Photo Preview">
          </div>

          <div class="file-input-container">
            <label>Signature *</label>
            <button type="button" mat-stroked-button color="accent" (click)="signatureInput.click()">
              <mat-icon>cloud_upload</mat-icon> Choose Signature
            </button>
            <input hidden type="file" #signatureInput accept="image/*" (change)="onFileSelected($event, 'signature')">
            <span class="file-name">{{ getFileName(selectedSignature) }}</span>
            <mat-error *ngIf="fileDetailsForm.get('signature')?.touched && fileDetailsForm.get('signature')?.hasError('required')">
              Signature is required
            </mat-error>
            <img *ngIf="signaturePreview" [src]="signaturePreview" class="file-preview" alt="Signature Preview">
          </div>

          <div class="file-input-container">
            <label>Resume (PDF only) *</label>
            <button type="button" mat-stroked-button color="accent" (click)="resumeInput.click()">
              <mat-icon>cloud_upload</mat-icon> Choose Resume
            </button>
            <input hidden type="file" #resumeInput accept=".pdf" (change)="onFileSelected($event, 'resume')">
            <span class="file-name">{{ getFileName(selectedResume) }}</span>
            <mat-error *ngIf="fileDetailsForm.get('resume')?.touched && fileDetailsForm.get('resume')?.hasError('required')">
              Resume is required
            </mat-error>
          </div>
        </div>
      </div>

      <!-- Academic Information Section -->
      <div class="form-section">
        <h3 class="section-header">Academic Information</h3>
        
        <div [formGroup]="academicDetailsForm">
          <!-- 10th Standard Entry -->
          <div class="academic-entry">
            <h4>10th Standard</h4>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Class/Degree</mat-label>
                <input matInput formControlName="class10th" readonly>
                <mat-error *ngIf="academicDetailsForm.get('class10th')?.invalid">
                  {{ getAcademicControlError('class10th') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Percentage/CGPA</mat-label>
                <input matInput type="number" formControlName="percent10th" min="0" max="100" step="0.01">
                <mat-error *ngIf="academicDetailsForm.get('percent10th')?.invalid">
                  {{ getAcademicControlError('percent10th') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Board/University</mat-label>
                <input matInput formControlName="board10th">
                <mat-error *ngIf="academicDetailsForm.get('board10th')?.invalid">
                  {{ getAcademicControlError('board10th') }}
                </mat-error>
              </mat-form-field>
            </div>
      
            <div class="file-input-container academic-file-input">
              <label>Marksheet (Image/PDF)</label>
              <button type="button" mat-stroked-button color="accent" (click)="marksheet10thInput.click()">
                <mat-icon>cloud_upload</mat-icon> Choose Marksheet
              </button>
              <input hidden type="file" #marksheet10thInput accept="image/*,.pdf"
                (change)="onFileSelected($event, 'marksheet-10th')">
              <span class="file-name">{{ getFileName(selectedMarksheet10th) }}</span>
            </div>
          </div>
      
          <!-- 12th Standard Entry -->
          <div class="academic-entry">
            <h4>12th Standard</h4>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Class/Degree</mat-label>
                <input matInput formControlName="class12th" readonly>
                <mat-error *ngIf="academicDetailsForm.get('class12th')?.invalid">
                  {{ getAcademicControlError('class12th') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Percentage/CGPA</mat-label>
                <input matInput type="number" formControlName="percent12th" min="0" max="100" step="0.01">
                <mat-error *ngIf="academicDetailsForm.get('percent12th')?.invalid">
                  {{ getAcademicControlError('percent12th') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Board/University</mat-label>
                <input matInput formControlName="board12th">
                <mat-error *ngIf="academicDetailsForm.get('board12th')?.invalid">
                  {{ getAcademicControlError('board12th') }}
                </mat-error>
              </mat-form-field>
            </div>
      
            <div class="file-input-container academic-file-input">
              <label>Marksheet (Image/PDF)</label>
              <button type="button" mat-stroked-button color="accent" (click)="marksheet12thInput.click()">
                <mat-icon>cloud_upload</mat-icon> Choose Marksheet
              </button>
              <input hidden type="file" #marksheet12thInput accept="image/*,.pdf"
                (change)="onFileSelected($event, 'marksheet-12th')">
              <span class="file-name">{{ getFileName(selectedMarksheet12th) }}</span>
            </div>
          </div>
      
          <!-- Undergraduate Entry -->
          <div class="academic-entry">
            <h4>Undergraduate</h4>
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Class/Degree</mat-label>
                <input matInput formControlName="classUG" readonly>
                <mat-error *ngIf="academicDetailsForm.get('classUG')?.invalid">
                  {{ getAcademicControlError('classUG') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Percentage/CGPA</mat-label>
                <input matInput type="number" formControlName="percentUG" min="0" max="100" step="0.01">
                <mat-error *ngIf="academicDetailsForm.get('percentUG')?.invalid">
                  {{ getAcademicControlError('percentUG') }}
                </mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Board/University</mat-label>
                <input matInput formControlName="boardUG">
                <mat-error *ngIf="academicDetailsForm.get('boardUG')?.invalid">
                  {{ getAcademicControlError('boardUG') }}
                </mat-error>
              </mat-form-field>
            </div>
      
            <div class="file-input-container academic-file-input">
              <label>Marksheet (Image/PDF)</label>
              <button type="button" mat-stroked-button color="accent" (click)="marksheetUGInput.click()">
                <mat-icon>cloud_upload</mat-icon> Choose Marksheet
              </button>
              <input hidden type="file" #marksheetUGInput accept="image/*,.pdf"
                (change)="onFileSelected($event, 'marksheet-ug')">
              <span class="file-name">{{ getFileName(selectedMarksheetUG) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Submit Section -->
      <div class="form-actions">
        <button mat-stroked-button color="warn" type="button" (click)="formReset()">Reset Form</button>
        <button mat-raised-button color="primary" (click)="onSubmitForm()" [disabled]="isLoading">
          Submit Registration
        </button>
      </div>

      <!-- Success message section -->
      <div *ngIf="registrationComplete" class="success-message">
        <mat-icon>check_circle</mat-icon>
        <h3>Registration Complete!</h3>
        <p>Thank you for registering. Your details have been submitted.</p>
      </div>
    </form>
  </mat-card-content>
</mat-card>